{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Dashboard</title>
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />


</head>
<body>
<div class="container">

<aside class="sidebar">
  <div class="logo">
    <img src="{% static 'images/logo.png' %}" alt="Singler Partners" style="width: 90px; vertical-align: middle;">
    <span style="margin-left: 8px; font-weight: bold; font-size: 18px;">Singler Partners</span>
  </div>
   
   <nav class="nav-menu">
        <a href="{% url 'dashboard' %}"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
        <a href="{% url 'contact_list' %}" class="active"><i class="fas fa-address-book"></i> Contacts</a>
        <a href="{% url 'feedback_list' %}"><i class="fas fa-comment-dots"></i> Feedback</a>
        <a href="{% url 'join_list' %}"><i class="fas fa-file-alt"></i> Applications</a>
        <a href="{% url 'partner_list' %}"><i class="fas fa-handshake"></i> Partnerships</a>
        <a href="{% url 'logout_two' %}"><i class="fas fa-info-circle"></i> About Us</a>
        <a href="{% url 'logout_three' %}"><i class="fas fa-house"></i> Home</a>
        <a href="{% url 'help' %}"><i class="fas fa-question-circle"></i> Help</a>
        <a href="{% url 'privacy_policy' %}"><i class="fas fa-user-shield"></i> Privacy Policy</a>
        <a href="{% url 'terms_of_service' %}"><i class="fas fa-file-contract"></i> Terms & Services</a>
       <a href="{% url 'logs_app:logs' %}" class="nav-link-logs"><i class="fas fa-clipboard-list"></i> System Logs</a>
       <a href="{% url 'logout' %}"><i class="fas fa-sign-out-alt"></i> Log Out</a>
    </nav>
</aside>

<main class="main-content">
    <header class="main-header">
        <div class="welcome">
            <h2>Dashboard Messages</h2>
            <p>Welcome, <strong style="color: gold;">{{ full_name }}</strong></p>
        </div>

                        
  <div class="user-info">
  <div class="user-info-left">
    <div class="notification" onclick="toggleDropdown('notifDropdown')">
      <span class="bell">&#128276;</span>
      {% if notifications_unread_count > 0 %}
        <span class="badge">{{ notifications_unread_count }}</span>
      {% endif %}
      <div id="notifDropdown" class="notification-dropdown" style="display:none;">
        {% if notifications %}
          <ul>
            {% for notification in notifications %}
              <li 
                onclick="openNotificationDetail(
                  {{ notification.pk }}, 
                  '{{ notification.title|escapejs }}', 
                  '{{ notification.message|escapejs }}',
                  '{{ notification.notification_type|escapejs }}',
                  '{{ notification.sender.username|default:'System'|escapejs }}',
                  '{{ notification.created_at|date:'Y-m-d H:i:s' }}',
                  '{{ notification.url|default:'' }}'
                )"
                style="cursor:pointer; padding: 8px; border-bottom: 1px solid #ddd;"
              >
                <strong>{{ notification.title }}</strong><br />
                <small>{{ notification.message|truncatewords:12 }}</small><br />
                <small><em>{{ notification.created_at|date:"M d, Y H:i" }}</em></small>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <ul><li>No notifications</li></ul>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Hidden detail card -->
  <div id="notifDetailCard" class="notif-detail-card" style="display:none; margin-top: 15px; border: 1px solid #ccc; padding: 15px;">
    <h3 id="detailTitle" style="margin-bottom: 10px;"></h3>
    
    <p><strong>Type:</strong> <span id="detailType"></span></p>
    <p><strong>Sender:</strong> <span id="detailSender"></span></p>
    <p><strong>Date:</strong> <span id="detailDate"></span></p>
    
    <p><strong>Message:</strong></p>
    <p id="detailMessage" style="white-space: pre-wrap; border: 1px solid #ddd; padding: 10px;"></p>
    
    <p id="detailUrlContainer" style="display:none;">
      <strong>Link:</strong> <a href="" target="_blank" id="detailUrl"></a>
    </p>
    
    <div class="btn-group" style="margin-top: 15px;">
      <form id="deleteNotificationForm" method="post" action="" style="display:inline;">
        {% csrf_token %}
        <button type="submit" class="btn-danger" style="background-color: #e74c3c; color: white; border: none; padding: 8px 12px; cursor: pointer;">Delete</button>
      </form>
      <button onclick="closeNotificationDetail()" class="btn-cancel" style="margin-left: 10px; padding: 8px 12px; cursor: pointer;">Back</button>
    </div>
  </div>





            <div class="profile" onclick="toggleDropdown('profileDropdown')">
                {% if profile_picture %}
                    <img src="{{ profile_picture }}" alt="Profile Picture" />
                {% else %}
                    <img src="{% static 'images/CCTV.avif' %}" alt="default" />
                {% endif %}

                <div class="profile-dropdown" id="profileDropdown">
                    <p><i class="fas fa-user"></i> <strong>Name:</strong> {{ full_name }}</p>
                    <p><i class="fas fa-envelope"></i> <strong>Email:</strong> {{ email }}</p>
                    <p><i class="fas fa-venus-mars"></i> <strong>Gender:</strong> {{ gender }}</p>
                    <p><i class="fas fa-birthday-cake"></i> <strong>DOB:</strong> {{ date_of_birth|date:"F j, Y" }}</p>
                    <p><i class="fas fa-phone"></i> <strong>Phone:</strong> {{ phone }}</p>
                    <p><i class="fas fa-map-marker-alt"></i> <strong>Location:</strong> {{ location }}</p>
                    <p><i class="fas fa-home"></i> <strong>Address:</strong> {{ address }}</p>
                    <p><i class="fas fa-building"></i> <strong>Department:</strong> {{ department }}</p>
                    <p><i class="fas fa-user-tie"></i> <strong>Role:</strong> {{ role }}</p>
                    <p><i class="fas fa-briefcase"></i> <strong>Type:</strong> {{ employment_type }}</p>
                    <p><i class="fas fa-calendar-alt"></i> <strong>Joined:</strong> {{ date_joined|date:"F j, Y" }}</p>

                    <div class="edit-profile-btn">
                        <a href="{% url 'update_profile' %}" class="edit-btn">
                            <i class="fas fa-edit"></i> Edit Profile
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Filters with Search -->
    <form method="get" action="{% url 'contact_list' %}" class="filters">
        <input type="text" name="q" placeholder="Search..." value="{{ request.GET.q }}">
        <select name="date"><option>Date</option></select>
        <select name="author"><option>Author</option></select>
        <select name="type"><option>Type</option></select>
        <button type="submit">Search</button>
    </form>
<section class="singler-dashboard">

  <!-- Card 1: Identity -->
  <div class="dashboard-card">
    <h3>üåê Singler Identity</h3>
    <p>15+ years of intelligence, risk mitigation, and investigative excellence in sub-Saharan Africa. Empowering global brands in challenging environments.</p>
  </div>

  <!-- Card 2: Core Capabilities -->
  <div class="dashboard-card">
    <h3>üõ†Ô∏è Core Capabilities</h3>
    <ul>
      <li>Risk Audits & Market Entry</li>
      <li>IP Enforcement & Anti-Counterfeiting</li>
      <li>Fraud & Internal Investigations</li>
      <li>Digital Forensics & Compliance</li>
    </ul>
  </div>

  <!-- Card 3: Strategic Reach -->
  <div class="dashboard-card">
    <h3>üìç Strategic Presence</h3>
    <p>
      Active in Kenya, Uganda, Tanzania, Nigeria, Ghana.<br>
      Growing footprint across Africa‚Äôs high-risk markets.
    </p>
  </div>

  <!-- Card 4: Trust Metrics -->
  <div class="dashboard-card">
    <h3>üîê Why Clients Trust Us</h3>
    <ul>
      <li>Discreet Investigations</li>
      <li>Law Enforcement Liaison</li>
      <li>Global Standards, Local Reach</li>
      <li>Results-Driven Intelligence</li>
    </ul>
  </div>

  <!-- Card 5: Risk Focus -->
  <div class="dashboard-card">
    <h3>‚ö†Ô∏è Emerging Risk Signals</h3>
    <p>Counterfeit growth in pharmaceuticals, fraud in logistics, IP violations in manufacturing, digital evidence loss in disputes.</p>
  </div>

  <!-- Card 6: Contact & Engage -->
  <div class="dashboard-card">
    <h3>üìû Get in Touch</h3>
    <p>üìç Nairobi HQ - Applewood Towers<br>üìß info@singlerpartners.com<br>üì± +254 722 388151<br><small>Mon‚ÄìFri: 08:00‚Äì18:00</small></p>
  </div>

</section>

</main>
</div>

<script>
  
function toggleDropdown(id) {
  const el = document.getElementById(id);
  el.classList.toggle('show');
  if (el.classList.contains('show')) {
    el.style.display = 'block';
  } else {
    el.style.display = 'none';
  }
}
function openNotificationDetail(pk, title, message, type, sender, date, url) {
  // Hide notification dropdown completely
  const dropdown = document.getElementById('notifDropdown');
  if (dropdown) {
    dropdown.classList.remove('show');
    dropdown.style.display = 'none'; // force hide
  }

  // Hide the notification dropdown's children to prevent overlapping, just in case
  if (dropdown) {
    Array.from(dropdown.children).forEach(child => {
      child.style.display = 'none';
    });
  }

  // Show the detail card
  const detailCard = document.getElementById('notifDetailCard');
  if (detailCard) {
    detailCard.style.display = 'block';
    detailCard.style.zIndex = '1100'; // Ensure detail card is above everything
  }

  // Set content in the detail card
  const titleEl = document.getElementById('detailTitle');
  const messageEl = document.getElementById('detailMessage');
  const typeEl = document.getElementById('detailType');
  const senderEl = document.getElementById('detailSender');
  const dateEl = document.getElementById('detailDate');
  const urlEl = document.getElementById('detailUrl');
  const urlContainer = document.getElementById('detailUrlContainer');

  if (titleEl) titleEl.textContent = title;
  if (messageEl) messageEl.textContent = message;
  if (typeEl) typeEl.textContent = type;
  if (senderEl) senderEl.textContent = sender;
  if (dateEl) dateEl.textContent = date;

  if (url && url.trim() !== "") {
    if (urlEl) {
      urlEl.href = url;
      urlEl.textContent = url;
    }
    if (urlContainer) {
      urlContainer.style.display = 'block';
    }
  } else {
    if (urlContainer) {
      urlContainer.style.display = 'none';
    }
  }

  // Set the delete form action URL
  const formEl = document.getElementById('deleteNotificationForm');
  if (formEl) {
    formEl.action = `/notifications/delete/${pk}/`;  // corrected URL
  }
}

// ‚úÖ Added this function to handle the back button
function closeNotificationDetail() {
  // Hide the detail card
  const detailCard = document.getElementById('notifDetailCard');
  if (detailCard) {
    detailCard.style.display = 'none';
  }

  // Show the notification dropdown again
  const dropdown = document.getElementById('notifDropdown');
  if (dropdown) {
    dropdown.style.display = 'block';
    dropdown.classList.add('show');

    // Show dropdown's children again
    Array.from(dropdown.children).forEach(child => {
      child.style.display = 'block';
    });
  }
}


</script>
</body>
</html>
